<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Game Collection UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="audio-panel">
        <button id="bgmToggle" title="Play / Pause"></button>
        <input id="bgmVolume" type="range" min="0" max="100" value="40">
    </div>

    <!-- ===== COLLECTION VIEW ===== -->
    <div id="collectionView">
        <div class="lang-exit" onclick="goLanguage()" title="Exit"></div>
        <div class="columns">
            <!-- MAIN STORY -->
            <div class="column">
                <h3>MAIN STORY</h3>
                <div class="main-grid">
                    <div class="card" onclick="play(sndCard); openDetail('main1')"><img src="img/main1.png">
                        <div class="title">冰封世界</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main2')"><img src="img/main2.png">
                        <div class="title">废土之下</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main3')"><img src="img/main3.png">
                        <div class="title">幽蓝边界</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main4')"><img src="img/main4.png">
                        <div class="title">管道迷宫</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main5')"><img src="img/main5.png">
                        <div class="title">霓虹灯牌</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main6')"><img src="img/main6.png">
                        <div class="title">方舟蜃景</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main7')"><img src="img/main7.png">
                        <div class="title">时钟链接</div>
                    </div>
                    <div class="card" onclick="play(sndCard); openDetail('main8')"><img src="img/main8.png">
                        <div class="title">凌日潮汐</div>
                    </div>
                </div>
            </div>

            <!-- SIDE STORY -->
            <div class="column side">
                <h3>SIDE STORY</h3>
                <div class="card" onclick="play(sndCard); openDetail('Lotus')"><img src="img/side1.png">
                    <div class="title">忘忧宫</div>
                </div>
                <div class="card" onclick="play(sndCard); openDetail('Eschaton')"><img src="img/side2.png">
                    <div class="title">弭刻日</div>
                </div>
                <div class="card" onclick="play(sndCard); openDetail('Operthief')"><img src="img/side3.png">
                    <div class="title">盗乐行</div>
                </div>
                <div class="card" onclick="play(sndCard); openDetail('Animitta-Sabha')"><img src="img/side4.png">
                    <div class="title">无相乡</div>
                </div>
            </div>

            <!-- MISC -->
            <div class="column misc">
                <h3>MISC</h3>
                <div class="card" onclick="play(sndCard); openDetail('Chapter EX')"><img src="img/Single.png">
                    <div class="title">额外章节</div>
                </div>
                <div class="card" onclick="play(sndCard); openDetail('BassAreUs')"><img src="img/bassareus.png">
                    <div class="title">外传章节极星卫</div>
                </div>
                <div class="card" onclick="play(sndCard); openDetail('Illustration')"><img
                        src="img/IllustrationsCover.png">
                    <div class="title">曲绘</div>
                </div>
                <div class="card external"
                    onclick="openExternal('https://wiki.pigeon-games.com/index.php?title=%E9%A6%96%E9%A1%B5')">
                    <img src="img/limbo.png">
                    <div class="title">Limbo</div>
                </div>

            </div>

        </div>

        <!-- COMPLETION -->
        <div class="completion">
            <div class="bar">
                <div class="bar-fill"></div>
            </div>
            <div class="percent">100%</div>
        </div>

    </div>

    <!-- ===== DETAIL ===== -->
    <div id="detailView">
        <div class="detail-wrap">
            <div class="sidebar">
                <div class="folder-header">FOLDER INFORMATION</div>
                <div class="folder-image">
                    <img id="chapterImg">
                    <div class="chapter-name" id="chapterName"></div>
                </div>

                <h4>CONTENT</h4>
                <div id="fileList"></div>
            </div>

            <div class="content">
                <button class="back" onclick="play(sndBack); back()">← BACK</button>
                <h2 id="title"></h2>
                <div class="meta" id="meta"></div>
                <div class="meta-divider"></div>
                <div class="text" id="text"></div>
            </div>
        </div>
    </div>

    <!-- ===== SOUND ===== -->
    <audio id="sndCard" src="sound/songInfoHide.wav" preload="auto"></audio>
    <audio id="sndBack" src="sound/openSaturnOS.wav" preload="auto"></audio>
    <audio id="sndItem" src="sound/songInfoShow.wav" preload="auto"></audio>
    <audio id="bgm" src="sound/Collecation0.mp3" preload="auto" loop></audio>

    <script>
        const bgm = document.getElementById("bgm");
        const bgmToggle = document.getElementById("bgmToggle");
        const bgmVolume = document.getElementById("bgmVolume");

        /* INITIAL STATE */
        bgm.volume = 0.4;
        bgmToggle.classList.add("pause");

        /* AUTO PLAY WHEN PAGE LOAD */
        window.addEventListener("click", () => {
            if (bgm.paused) {
                bgm.currentTime = 0;
                bgm.play().catch(() => { });
            }
        }, { once: true });

        /* PLAY / PAUSE BUTTON */
        bgmToggle.onclick = () => {
            if (bgm.paused) {
                bgm.currentTime = 0;   // luôn phát lại từ đầu
                bgm.play();
                bgmToggle.classList.remove("play");
                bgmToggle.classList.add("pause");
            } else {
                bgm.pause();
                bgmToggle.classList.remove("pause");
                bgmToggle.classList.add("play");
            }
        };

        /* VOLUME CONTROL */
        bgmVolume.oninput = () => {
            bgm.volume = bgmVolume.value / 100;
        };

        const collection = document.getElementById("collectionView");
        const detail = document.getElementById("detailView");
        const title = document.getElementById("title");

        const sndCard = document.getElementById("sndCard");
        const sndBack = document.getElementById("sndBack");
        const sndItem = document.getElementById("sndItem");

        sndCard.volume = 0.5;
        sndBack.volume = 0.4;
        sndItem.volume = 0.35;
        const meta = document.getElementById("meta");
        const text = document.getElementById("text");
        const fileList = document.getElementById("fileList");
        const chapterImg = document.getElementById("chapterImg");
        const chapterName = document.getElementById("chapterName");

        function buildMeta(metaText, category) {
            const parts = metaText.split(" · ");
            return `<span>${parts[0]}</span><span>${parts[1]}</span><span>CATEGORY ${category}</span>`;
        }

        function openDetail(key) {
            const chapter = CHAPTER_DATA[key];
            if (!chapter) return;

            /* ===== FADE OUT COLLECTION ===== */
            collection.classList.add("fade-exit-active");

            setTimeout(() => {
                /* ===== SWITCH VIEW ===== */
                collection.style.display = "none";
                collection.classList.remove("fade-exit-active");

                detail.style.display = "block";
                detail.classList.add("fade-enter");

                /* ===== LOAD CHAPTER INFO ===== */
                chapterImg.src = chapter.chapterImg;
                chapterName.innerText = chapter.chapterName;
                fileList.innerHTML = "";

                chapter.contentList.forEach((item, i) => {
                    const div = document.createElement("div");
                    div.className = "file";
                    div.innerText = item.name;

                    div.onclick = () => {
                        play(sndItem); // 
                        [...fileList.children].forEach(f => f.classList.remove("active"));
                        div.classList.add("active");
                        title.innerText = item.name;
                        meta.innerHTML = buildMeta(item.meta, chapter.category);
                        text.innerText = item.text;
                    };

                    fileList.appendChild(div);

                    /* ===== AUTO LOAD FILE (NO SOUND) ===== */
                    if (i === 0) {
                        div.classList.add("active");
                        title.innerText = item.name;
                        meta.innerHTML = buildMeta(item.meta, chapter.category);
                        text.innerText = item.text;
                    }
                });

                /* ===== FADE IN DETAIL ===== */
                requestAnimationFrame(() => {
                    detail.classList.add("fade-enter-active");
                });

                setTimeout(() => {
                    detail.classList.remove("fade-enter", "fade-enter-active");
                }, 400);

            }, 250);
        }

        function play(s) {
            if (!s) return;
            s.currentTime = 0;
            s.play().catch(() => { });
        }

        function back() {
            play(sndBack);

            // reset  detail before animate
            detail.classList.remove("fade-enter", "fade-enter-active", "fade-exit-active");

            detail.classList.add("fade-exit-active");

            setTimeout(() => {
                detail.style.display = "none";
                detail.classList.remove("fade-exit-active");

                // show collection
                collection.style.display = "block";
                collection.classList.remove("fade-enter", "fade-enter-active", "fade-exit-active");
                collection.classList.add("fade-enter");

                requestAnimationFrame(() => {
                    collection.classList.add("fade-enter-active");
                });

                setTimeout(() => {
                    collection.classList.remove("fade-enter", "fade-enter-active");
                }, 400);

            }, 250);
        }
        function goLanguage() {
            play(sndBack); // if you need sound
            setTimeout(() => {
                window.location.href = "language.html";
            }, 150);
        }
        function openExternal(url) {
            play(sndCard);   // use current sound click 
            setTimeout(() => {
                window.open(url, "_blank");
            }, 150);
        }



    </script>
    <script>
        /* DATA  */
        const CHAPTER_DATA = {
            main1: {
                chapterName: "Glaciaxion",
                chapterImg: "img/main1.png",
                category: "main",
                contentList: [
                    {
                        name: "Stave No.0",
                        meta: "收集时间 770/05/21 · 保管单位 镜",
                        text: "摘自Phigros计划\n\n曾有流浪人\n未受洗礼\n未信神\n\n攀似绿箩藤\n圣石登宵\n持剑诰\n\n我要这\n穹顶降镐\n地霜共冰消\n渊无饥骨\n路非遥\n\n垂髫闻\n沉思莞尔\n\n教后生：何不\n振臂筑塔\n\n通云霄\n\n\u2003——2089.10.27"
                    },
                    {
                        name: "Stave No.1",
                        meta: "DATE 770/05/22 · SUPERVISOR Mirror",
                        text: "Like white vines on a holy stone..."
                    }
                ]
            },

            main2: {
                chapterName: "Beneath the Trash",
                chapterImg: "img/main2.png",
                category: "main",
                contentList: [
                    {
                        name: "Stave No.7",
                        meta: "DATE 770/04/01 · SUPERVISOR Deathmark",
                        text: "Has it started?\n\nAwoken from a dream..."
                    }
                ]
            },
            main3: {
                chapterName: "Mazarine's End",
                chapterImg: "img/main3.png",
                category: "main",
                contentList: [
                    {
                        name: "Stave No.7",
                        meta: "DATE 770/04/01 · SUPERVISOR Deathmark",
                        text: "Has it started?\n\nAwoken from a dream..."

                    }
                ]
            },
            main4: {
                chapterName: "Sewer Maze",
                chapterImg: "img/main4.png",
                category: "main",
                contentList: [
                    {
                    }
                ]
            }
        };

    </script>
</body>

</html>